---
title: "Using FREEC to analyse CNVs in wild maize"
author: "Simon Renny-Byfield"
date: "February 3, 2015"
output: html_document
---

As part of my project we are interested in calling PAV-CNV in 20 teosinte individuals from a single population near Palmar Chico, Mexico. I have tried a number of options, none of which are producing what seems like sensible results and so I have decided to pursue different approaches.

[FREEC]("http://bioinformatics.oxfordjournals.org/content/27/2/268.long") infers "control-free copy number alteration (CNA)" detection using deep-sequencing data. The installation is standard and won't be detailed here but there are quite a few auxiliary files that are needed and I will go through how these are generated.

##The config file##

FREEC requires the generation of a config file. An example of such a file is given below:

```
[general]

chrLenFile = hs18_chr.len
coefficientOfVariation = 0.062
ploidy = 3

#breakPointThreshold = -.002;
#window = 50000
#chrFiles = hg18/hg18_per_chromosome
#outputDir = test
#degree=3
#intercept = 0

[sample]

mateFile = HCC1143.arachne
inputFormat = arachne
mateOrientation = 0

#mateCopyNumberFile = HCC1143.arachne_sample.cpn

[control]

mateFile = HCC1143_BL.arachne
inputFormat = arachne
mateOrientation = 0

#mateCopyNumberFile = HCC1143_BL.arachne_control.cpn
```

also see [here]("http://bioinfo-out.curie.fr/projects/freec/tutorial.html#CONFIG") for detailed descriptions of what files are needed. From this point on I am using this webpage as guidance for generating the required files. I already have the cHr length file and it looks like this:
```
1  1	301476924
2	2	237917468
3	3	232245527
4	4	242062272
5	5	217959525
6	6	169407836
7	7	176826311
8	8	175377492
9	9	157038028
10	10	149632204
```
This is for maize `AGPv3.22`.

So the next step is to generate single sequences for each chromosome using a very specific genome references sequence. In this case it is version 3.22, a version of this can be found in `/home/vince251/data/refgen3-hapmap/maize3.fa.gz` which is the exact sequence that the `.bam` files were mapped to. So now to split the sequence up...

The sequences have been split using the following BioPerl heavy script:
```
#!usr/bin/perl
use strict;
use warnings;
use Bio::SeqIO;

###############################
#Simon Renny-Byfield, UC Davis, 7th November 2014, version 1
###############################

#usage script.pl <fasta> 

#This script takes fasta files and splits the sequences into individual files

#Initialize the Bio:SeqIO object; 
my $seqIO = Bio::SeqIO -> new ( -format => "fasta" , -file => $ARGV[0] );

#also intilize a file to contain all the nam
#start looping through the sequences
while ( my $seqObj = $seqIO->next_seq() ) {
  #get the sequence id
	my $name = $seqObj->id;
	#open up a new file with the seq id as name
	open(NEWFASTA, ">$name".".fasta" ) || die "could not open file:$!\n";
	#print the name of the sequence
	print NEWFASTA ">$name\n";
	#grab the sequence string
	my $seqstr = $seqObj->seq();
	#print it
	print NEWFASTA "$seqstr\n";
	#close the file handle
	close(NEWFASTA) 
}#while

exit;
```




